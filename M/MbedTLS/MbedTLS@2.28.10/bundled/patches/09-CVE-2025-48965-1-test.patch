From eceabee01342dcdb03bb0144ab3e33b04e29977b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Manuel=20P=C3=A9gouri=C3=A9-Gonnard?=
 <manuel.pegourie-gonnard@arm.com>
Date: Mon, 26 May 2025 10:55:59 +0200
Subject: [PATCH] Improve unit tests for mbedtls_asn1_store_named_data
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Every time we check found->val.p we should also check found->val.len.

Signed-off-by: Manuel Pégourié-Gonnard <manuel.pegourie-gonnard@arm.com>
---
 tests/suites/test_suite_asn1write.function | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/tests/suites/test_suite_asn1write.function b/tests/suites/test_suite_asn1write.function
index e79a938cb8..6cc82f69d0 100644
--- a/tests/suites/test_suite_asn1write.function
+++ b/tests/suites/test_suite_asn1write.function
@@ -619,10 +619,14 @@ void store_named_data_val_new( int new_len, int set_new_val )
     TEST_ASSERT( found == head );
     TEST_ASSERT( found->oid.p != oid );
     ASSERT_COMPARE( found->oid.p, found->oid.len, oid, oid_len );
-    if( new_len == 0 )
+    if( new_len == 0 ) {
         TEST_ASSERT( found->val.p == NULL );
-    else if( new_val == NULL )
+        TEST_EQUAL(found->val.len, 0);
+    }
+    else if( new_val == NULL ) {
         TEST_ASSERT( found->val.p != NULL );
+        TEST_EQUAL(found->val.len, new_len);
+    }
     else
     {
         TEST_ASSERT( found->val.p != new_val );
-- 
2.39.5 (Apple Git-154)

