From: Manuel Pégourié-Gonnard <manuel.pegourie-gonnard@arm.com>
Date: Mon, 5 May 2025 18:25:26 +0200
Subject: Add unit test for new behaviour of string_to_names()

Signed-off-by: Manuel Pégourié-Gonnard <manuel.pegourie-gonnard@arm.com>

Origin: backport, https://github.com/Mbed-TLS/mbedtls/commit/bda3ab927826ae7603a46d8073790cc051848976
---
 tests/suites/test_suite_x509write.function | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/tests/suites/test_suite_x509write.function b/tests/suites/test_suite_x509write.function
index 40bccd6..787a004 100644
--- a/tests/suites/test_suite_x509write.function
+++ b/tests/suites/test_suite_x509write.function
@@ -255,6 +255,11 @@ void mbedtls_x509_string_to_names( char * name, char * parsed_name, int result
 
     TEST_ASSERT( strcmp( (char *) out, parsed_name ) == 0 );
 
+    /* Check that calling a 2nd time with the same param (now non-NULL)
+     * returns an error as expected. */
+    ret = mbedtls_x509_string_to_names(&names, name);
+    TEST_EQUAL(ret, MBEDTLS_ERR_X509_BAD_INPUT_DATA);
+
 exit:
     mbedtls_asn1_free_named_data_list( &names );
 
