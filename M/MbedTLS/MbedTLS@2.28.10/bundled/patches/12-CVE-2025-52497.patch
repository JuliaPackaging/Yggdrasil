From: Felix Conway <felix.conway@arm.com>
Date: Tue, 27 May 2025 16:00:48 +0100
Subject: Add fix for PEM underflow

Signed-off-by: Felix Conway <felix.conway@arm.com>
---
 library/pem.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/library/pem.c b/library/pem.c
index 1d63774..d24add5 100644
--- a/library/pem.c
+++ b/library/pem.c
@@ -253,7 +253,10 @@ exit:
 #if defined(MBEDTLS_DES_C) || defined(MBEDTLS_AES_C)
 static int pem_check_pkcs_padding(unsigned char *input, size_t input_len, size_t *data_len)
 {
-    /* input_len > 0 is guaranteed by mbedtls_pem_read_buffer(). */
+    /* input_len > 0 is not guaranteed by mbedtls_pem_read_buffer(). */
+    if (input_len < 1) {
+        return MBEDTLS_ERR_PEM_INVALID_DATA;
+    }
     size_t pad_len = input[input_len - 1];
     size_t i;
 
