From f6e8bc8a014eaf4bb86417237375c2c735ec118a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Manuel=20P=C3=A9gouri=C3=A9-Gonnard?=
 <manuel.pegourie-gonnard@arm.com>
Date: Mon, 5 May 2025 18:25:26 +0200
Subject: [PATCH] Add unit test for new behaviour of string_to_names()
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Manuel Pégourié-Gonnard <manuel.pegourie-gonnard@arm.com>

Origin: backport, https://github.com/Mbed-TLS/mbedtls/commit/bda3ab927826ae7603a46d8073790cc051848976
---
 tests/suites/test_suite_x509write.function | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/tests/suites/test_suite_x509write.function b/tests/suites/test_suite_x509write.function
index 61b317c625..e3d8a7bddf 100644
--- a/tests/suites/test_suite_x509write.function
+++ b/tests/suites/test_suite_x509write.function
@@ -489,6 +489,11 @@ void mbedtls_x509_string_to_names(char *name, char *parsed_name, int result
 
     TEST_ASSERT(strcmp((char *) out, parsed_name) == 0);
 
+    /* Check that calling a 2nd time with the same param (now non-NULL)
+     * returns an error as expected. */
+    ret = mbedtls_x509_string_to_names(&names, name);
+    TEST_EQUAL(ret, MBEDTLS_ERR_X509_BAD_INPUT_DATA);
+
 exit:
     mbedtls_asn1_free_named_data_list(&names);
 
-- 
2.39.5 (Apple Git-154)

