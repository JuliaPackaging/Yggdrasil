From bab93af2b19f2b74380299667953bc3c0952f916 Mon Sep 17 00:00:00 2001
From: Felix Conway <felix.conway@arm.com>
Date: Tue, 27 May 2025 14:54:07 +0100
Subject: [PATCH] Add test using underflow-causing PEM keyfile

Signed-off-by: Felix Conway <felix.conway@arm.com>
---
 tests/suites/test_suite_pem.data | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/tests/suites/test_suite_pem.data b/tests/suites/test_suite_pem.data
index b63755452a..798d21eab0 100644
--- a/tests/suites/test_suite_pem.data
+++ b/tests/suites/test_suite_pem.data
@@ -34,6 +34,10 @@ PEM read (unknown encryption algorithm)
 depends_on:MBEDTLS_AES_C
 mbedtls_pem_read_buffer:"^":"$":"^\nProc-Type\: 4,ENCRYPTED\nDEK-Info\: AES-,00$":"pwd":MBEDTLS_ERR_PEM_UNKNOWN_ENC_ALG
 
+PEM read (malformed PEM AES-128-CBC with fewer than 4 base64 chars)
+depends_on:MBEDTLS_MD_CAN_MD5:MBEDTLS_AES_C:MBEDTLS_CIPHER_MODE_CBC
+mbedtls_pem_read_buffer:"-----BEGIN EC PRIVATE KEY-----":"-----END EC PRIVATE KEY-----":"-----BEGIN EC PRIVATE KEY-----\nProc-Type\: 4,ENCRYPTED\nDEK-Info\: AES-128-CBC,7BA38DE00F67851E4207216809C3BB15\n\n8Q-----END EC PRIVATE KEY-----":"pwd":MBEDTLS_ERR_PEM_INVALID_DATA
+
 PEM read (malformed PEM DES-CBC)
 depends_on:MBEDTLS_DES_C:MBEDTLS_CIPHER_MODE_CBC
 mbedtls_pem_read_buffer:"-----BEGIN EC PRIVATE KEY-----":"-----END EC PRIVATE KEY-----":"-----BEGIN EC PRIVATE KEY-----\nProc-Type\: 4,ENCRYPTED\nDEK-Info\: DES-CBC,AA94892A169FA426\n\nMAAA\n-----END EC PRIVATE KEY-----":"pwd":MBEDTLS_ERR_DES_INVALID_INPUT_LENGTH
-- 
2.39.5 (Apple Git-154)

